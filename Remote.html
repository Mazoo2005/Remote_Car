<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>تحكم في السيارة الذكية</title>
  <style>
    body { background: #20223a; color: #fff; font-family: 'Cairo', sans-serif; }
    .controls { margin: 30px auto; display: flex; flex-direction: column; align-items: center; }
    .row { margin: 10px; }
    button { margin: 5px; padding: 10px 15px; font-size: 18px; border-radius: 8px; border: none; }
    #response { margin-top: 20px; background: #333; padding: 10px; border-radius: 8px; min-height: 40px; }
  </style>
</head>
<body>
  <h1>تحكم في السيارة الذكية</h1>
  <div class="controls">
    <div class="row">
      <button onclick="sendCommand('F')">أمام</button>
    </div>
    <div class="row">
      <button onclick="sendCommand('L')">يسار</button>
      <button onclick="sendCommand('S')">توقف</button>
      <button onclick="sendCommand('R')">يمين</button>
    </div>
    <div class="row">
      <button onclick="sendCommand('B')">خلف</button>
    </div>
    <div class="row">
      <button onclick="sendCommand('1')">ريكورد 1</button>
      <button onclick="sendCommand('2')">ريكورد 2</button>
      <!-- أضف باقي الريكوردات حسب الحاجة -->
    </div>
    <div class="row">
      <input type="text" id="question" placeholder="اسأل عن أي شيء..." />
      <button onclick="askAI()">اسأل</button>
    </div>
    <div id="response"></div>
  </div>
  <button onclick="connectBluetooth()">اتصال بالبلوتوث</button>
  <script>
    let bluetoothDevice;
    let bluetoothCharacteristic;

    async function connectBluetooth() {
      try {
        bluetoothDevice = await navigator.bluetooth.requestDevice({
          filters: [{ namePrefix: 'HC' }], // أو حسب اسم وحدتك
          optionalServices: [0xFFE0]
        });
        const server = await bluetoothDevice.gatt.connect();
        const service = await server.getPrimaryService(0xFFE0);
        bluetoothCharacteristic = await service.getCharacteristic(0xFFE1);
        alert('تم الاتصال بالبلوتوث!');
      } catch (e) {
        alert('فشل الاتصال: ' + e);
      }
    }

    async function sendCommand(cmd) {
      if (bluetoothCharacteristic) {
        const encoder = new TextEncoder();
        await bluetoothCharacteristic.writeValue(encoder.encode(cmd));
      } else {
        alert('يجب الاتصال بالسيارة أولاً!');
      }
    }

    async function askAI() {
      const question = document.getElementById('question').value;
      document.getElementById('response').innerText = '...جاري البحث';
      // مثال على استخدام OpenAI API (تحتاج مفتاح API)
      const apiKey = 'YOUR_OPENAI_API_KEY';
      try {
        const res = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + apiKey
          },
          body: JSON.stringify({
            model: 'gpt-3.5-turbo',
            messages: [{role: 'user', content: question}]
          })
        });
        const data = await res.json();
        const answer = data.choices[0].message.content.trim();
        document.getElementById('response').innerText = answer;
        // تحويل النص لصوت
        const utter = new SpeechSynthesisUtterance(answer);
        utter.lang = 'ar-EG';
        speechSynthesis.speak(utter);
      } catch (e) {
        document.getElementById('response').innerText = 'حدث خطأ!';
      }
    }
  </script>
</body>
</html>